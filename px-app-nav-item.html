<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html"/>
<link rel="import" href="../px-polymer-font-awesome/px-icon-set.html"/>
<link rel="import" href="css/px-app-nav-item-styles.html">

<dom-module id="px-app-nav-item">
  <template>
    <style include="px-app-nav-item-styles"></style>

    <template is="dom-if" if="{{_propIsTypeOf(icon, 'string')}}">
      <iron-icon class$="app-nav-item__icon {{_getIconAndLabelClasses(label)}}" icon="{{icon}}"></iron-icon>
    </template>

    <template is="dom-if" if="{{_propIsTypeOf(label, 'string')}}">
      <p class="app-nav-item__label">{{label}}</p>
    </template>

    <template is="dom-if" if="{{empty}}">
      <div class="app-nav-item__icon app-nav-item__icon--with-label app-nav-item__icon--empty"></div>
      <div class="app-nav-item__label app-nav-item__label--empty"></div>
    </template>

    <template is="dom-if" if="{{dropdown}}">
      <iron-icon class="app-nav-item__dropdown-icon" icon="px:chevron-down"></iron-icon>
    </template>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-app-nav-item',

    properties: {
      /**
       * Used as the label text for the item.
       */
      label: {
        type: String
      },

      /**
       * Used to set the icon for the item. Should be a valid font awesome icon name.
       */
      icon: {
        type: String
      },

      /**
       * A named path for this item. Used to select it programatically, e.g.
       * by binding to the current URL route. Path names cannot have a dot
       * ('.') in them or they will not work.
       */
      path: {
        type: String,
        reflectToAttribute: true
      },

      /**
       * Shows a dropdown arrow icon to indicate this item can be tapped to
       * open a subgroup.
       */
      dropdown: {
        type: Boolean,
        value: false
      },

      /**
       * Optional. The index of the item in a group of other items. Helps with
       * selecting an item when no paths are provided. If you provide a path,
       * you do not need to set this. If possible, items will be automatically
       * indexed as they're added to the navigation.
       */
      index: {
        type: Number
      },

      /**
       * Set to `true` if the item is inside a overflowed dropdown.
       */
      overflowed: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: 'updateStyles' // Necessary to ensure correct style scoping for iron-icon
      },

      /**
       * Set to `true` if the item is in a collapsed dropdown.
       */
      collapsed: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: 'updateStyles'
      },

      /**
       * Set to `true` if the item is selected.
       */
      selected: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: 'updateStyles' // Necessary to ensure correct style scoping for iron-icon
      },

      /**
       * Shows an empty state outline for the button instead of a label/icon.
       */
      empty: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },

      /**
       * Cancels events that trigger selection.
       */
      cancelSelect: {
        type: Boolean,
        value: false
      }
    },

    attached() {
      this.listen(this, 'tap', '_handleSelfTapped');
    },

    detached() {
      this.unlisten(this, 'tap', '_handleSelfTapped');
    },

    /**
     * Checks if a property is the desired `type`.
     *
     * @param {*} prop
     * @returns {Boolean}
     */
    _propIsTypeOf(prop, type) {
      return prop && type && (typeof prop === type);
    },

    /**
     * Fire the select event so this item's parent will mark it as selected.
     */
    _handleSelfTapped(evt) {
      if (this.cancelSelect) return;
      var path = this.path ? this.path : (typeof this.index === 'number' ? this.index : this.item);
      this.fire('px-app-nav-item-tapped', {
        path: [path]
      }, {cancelable:true});
    },

    /**
     * If an item has an icon and a label, get class to add margin between them.
     */
    _getIconAndLabelClasses(labelStr) {
      return (typeof labelStr === 'string' && labelStr.length) ? 'app-nav-item__icon--with-label' : '';
    }
  });
</script>
