<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../px-polymer-font-awesome/px-polymer-font-awesome.html" />

<link rel="import" href="css/px-app-nav-item-styles.html">

<dom-module id="px-app-nav-item">
  <template>
    <style include="px-app-nav-item-styles"></style>

    <div class="app-nav-item" on-tap="_handleSelfTapped">
      <template is="dom-if" if="{{_propIsTypeOf(icon, 'string')}}">
        <iron-icon class="app-nav-item__icon" icon="fa:{{icon}}"></iron-icon>
      </template>

      <template is="dom-if" if="{{_propIsTypeOf(label, 'string')}}">
        <p class="app-nav-item__label">{{label}}</p>
      </template>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-app-nav-item',

    properties: {
      /**
       * If `true` the item is selected.
       *
       * Watch for updates to find out when the item becomes selected through
       * user interaction or through automatic selection.
       *
       * Set the `selected` attribute to `true` or `false` to automatically
       * select or deselect the item.
       */
      selected: {
        type: Boolean,
        value: false,
        notify: true,
        reflectToAttribute: true,
        observer: '_handleSelectedChanged'
      },

      /**
       * Used as the label text for the item.
       */
      label: {
        type: String
      },

      /**
       * Used to set the icon for the item. Should be a valid font awesome icon name.
       */
      icon: {
        type: String
      },

      /**
       * A named path for this item. Used to select it programatically, e.g.
       * by binding to the current URL route.
       */
      path: {
        type: String,
        reflectToAttribute: true
      }
    },

    /**
     * Checks if a property is the desired `type`.
     *
     * @param {*} prop
     * @returns {Boolean}
     */
    _propIsTypeOf(prop, type) {
      return prop && type && (typeof prop === type);
    },

    /**
     * Fire the select event so this item's parent will mark it as selected.
     */
    _handleSelfTapped(evt) {
      if (!this.selected) {
        this.set('selected', true);
      }
    },

    /**
     * When the selected state is updated interally (e.g. by one of the methods
     * of this item) or externally (e.g. through another component setting
     * the selected state), fire events that will cause the parent to select
     * or deselect this item.
     */
    _handleSelectedChanged(nextState, lastState) {
      if (nextState === true) {
        this.fire('px-app-nav-item-selected', {
          path: this.path ? [this.path] : [this]
        });
      }
      if (nextState === false) {
        this.fire('px-app-nav-item-deselected', {
          path: this.path ? [this.path] : [this]
        });
      }
    }
  });
</script>
