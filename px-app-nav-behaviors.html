<script>
  (function() {
    var behaviors = window.PxAppNavBehaviors = (window.PxAppNavBehaviors || {});

    behaviors.GroupImpl = {
      properties: {
        /**
         * If `true` the group is opened and its sub-items are visible.
         */
        opened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * When the dropdown is opened, this element will be measured and its
         * width will be set as the min width of the contentEl.
         */
        minWidthSizer: {
          type: HTMLElement
        },

        /**
         * The HTMLElement that wraps around the group's dropdown content.
         */
        contentEl: {
          type: HTMLElement
        }
      },

      attached: function() {
        this.unlisten(this, 'tap', '_foo');
        this.listen(this.$.itemButton, 'tap', '_handleSelfTapped');
        this.listen(this.dropdownEl, 'px-app-nav-item-selected', '_handleItemSelected');
      },

      detached: function() {
        this.unlisten(this.$.itemButton, 'tap', '_handleSelfTapped');
        this.unlisten(this.dropdownEl, 'px-app-nav-item-selected', '_handleItemSelected');
      },

      _handleSelfTapped: function(evt) {
        this._toggleGroup();
      },

      _toggleGroup() {
        if (this.opened) {
          this.async(function(){
            // Wait a tick before closing for the group to clear its event queue
            // after we stopped the original cancel event
            this.closeGroup();
          });
        }
        if (!this.opened) {
          this.openGroup();
        }
      },

      openGroup() {
        if (this.minWidthSizer && this.contentEl) {
          var minWidth = this.minWidthSizer.getBoundingClientRect().width + 'px';
          if (this.contentEl.style.minWidth !== minWidth) {
            this.contentEl.style.minWidth = minWidth;
          }
        }

        this.set('opened', true);
      },

      closeGroup() {
        this.set('opened', false);
      }
    };
    behaviors.Group = [behaviors.GroupImpl];
  })();
</script>
